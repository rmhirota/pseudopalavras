---
title: "CENTRO DE ESTATÍSTICA APLICADA – CEA – USP"
subtitle: "RELATÓRIO DE CONSULTA"
author: 
  - Giovanna Vilar
  - Mariana Almeida
  - Renata Hirota
date: "`r format(Sys.Date(), '%B/%Y')`"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```


__TÍTULO:__ Fatores associados à evasão e conclusão de curso na UFRJ: análise de heterogeneidade

__PESQUISADOR:__ Melina Klitzke Martins

__ORIENTADOR:__ Rosana Heringer, Flávio Carvalhaes

__INSTITUIÇÃO:__ Universidade Federal do Rio de Janeiro

__FINALIDADE DO PROJETO:__ Doutorado

__PARTICIPANTES DA ENTREVISTA:__ 

- Melina Klitzke Martins
- Flávio Carvalhaes
- Monica Carneiro Sandoval 
- Denise Aparecida Botter
- Viviana Giampaoli
- Giovanna Vilar
- Mariana Almeida
- Renata Hirota

__DATA:__ 23/04/2020

__FINALIDADE DA CONSULTA:__ Consultoria sobre o modelo logístico multinível; auxílio na pós-estimação do modelo e na interpretação dos coeficientes 


__RELATÓRIO ELABORADO POR:__ 
- Giovanna Vilar
- Mariana Almeida
- Renata Hirota

\newpage

# Introdução

A evasão dos alunos no ensino superior é uma situação recorrente e estudada por diversos autores no campo da educação e das ciências sociais.Em suma, como as variações  nos ambientes acadêmicos moldam as experiências e os resultados dos alunos de diferentes  maneiras, as disparidades entre as distribuições dos estudantes em todas as áreas de estudo, ainda  que pequenas, podem contribuir para entender as desigualdades de resultados quanto à evasão de curso.
Logo, o projeto busca analisar quais os fatores estão associados à evasão e conclusão de curso na UFRJ e como o efeito  desses fatores variam entre cursos.
Para isso, será utilizado um modelo logístico multinivel (hierárquico),em que o nível 1 são os estudantes e o nível 2 são  os cursos. 
A pesquisadora busca com a entrevista uma consultoria sobre o modelo logístico multinível e um auxílio na pós-estimação do modelo e na interpretação dos coeficientes.


- Descrição geral do projeto, incluindo a utilidade prática. 
- Indicação do tipo de estudo: experimento laboratorial, estudo observacional,
ensaio clínico, etc. 
- Finalidade da entrevista: planejamento amostral, elaboração de questionário,
crítica de análises realizadas, sugestão para análise, etc.

# Descrição do estudo

O estudo foi planejado como um modelo logístico multinivel (hierárquico),em que o nível 1 são os estudantes e o nível 2 são os cursos. A pesquisadora selecionou todos os cursos de modalidade presencial ofertados pela UFRJ e, a partir da volumetria, agrupou-os de acordo com o tipo de curso. Por exemplo, cursos como Letras-Espanhol, Letras-Inglês e Letras-Português foram agrupados no mesmo bloco. Ao fim desse agrupamento, foram obtidos 45 clusters. É importante destacar que o curso de medicina foi excluído da análise pois não era possível acompanhar esses ingressantes. Além disso, cada cluster possui um minímo de 30 observações.
As unidades amostrais da pesquisa são os ingressantes no primeiro semestre do ano de 2014, um total de 4.480 observações. Todos esses alunos foram seguidos pelo número de matrícula até um ano e meio após o primeiro semestre de 2019. 
Essa é uma pesquisa longitudinal mas, como informado pela pesquisadora, no modelo sugerido nesse relatório não será considerado esse planejamento

- Tipo de planejamento/amostragem (número de fatores, níveis, presença de dados incompletos, etc.). 
- Identificação e número de unidades amostrais. 

# Descrição das Variáveis e Processo de Coleta de Dados

A base de dados utilizada foi construída a partir dos microdados da coorte fornecidos pela Divisão de Registro de Estudante (DRE/ Pr1) da UFRJ. A maioria das informações são coletadas através do questionário socioeconômico, produzido e aplicado pela instituição no ato da pré-matrícula do estudante. O bom índice de  respostas, possivelmente, deve-se ao fato de que o estudante precisa apresentar o comprovante  da realização da pré-matrícula, exigido no ato de confirmação da matrícula presencial. O referido  questionário é composto por questões que abordam, entre outras informações, aspectos  socioeconômicos, culturais, escolares, de composição familiar e de escolha e expectativas sobre o  curso e sobre a instituição.
A variável dependente (resposta) utilizada nessa análise éa evasão do curso no primeiro ano  (1° e 2° semestre), representada por 0 e 1 (0= não evadiu; 1= evadiu). O conceito de evasão aqui utilizado é o de evasão do  curso, que é aquela em que o aluno deixa o curso de origem por qualquer razão (LOBO, 2012). Essas variáveis foram construídas através da combinação da variável de tempo que o indivíduo  permaneceu no curso e a situação de matrícula em cada semestre – ativa, trancada, cancelada,  cancelado por conclusão de curso. Destacamos que apenas aqueles que tiveram suas matrículas no curso canceladas (exceto o cancelamento por conclusão de curso), é que foram considerados  evadidos.  
Em um estudo multinivel as variáveis independentes são classificados em dois tipos: variáveis de nível 1 variáveis de nível 2. Aqui, as variáveis de nível 1 são as de origem dos estudantes:  
  
- Cor/Raça (0 = brancos e 1 = pretos e  pardos)  
- Sexo (0 = feminino e 1 = masculino)  
- Status socioeconômico da família (SES), mensurado pela maior escolaridade do pai ou da mãe (0 = menos que o ensino superior e 1= ensino superior)  
- Nota no ENEM no ano de entrada    
- Variável que diz respeito a questão “se foi a primeira opção de curso”  
(0 = sim; 1 = não)  
- Variável que diz respeito a questão “se a nota de corte influenciou na escolha do curso” (0 = não; 1= sim)  
- Coeficiente de Rendimento acumulado por semestre (CRa), relacionado ao último semestre acompanhado  
  
No nível do curso, inicialmente a pesquisadora criou uma variável de seletividade de curso  utilizando a nota mediana do curso no Enem. Se a nota mediana do curso no Enem era maior que  a nota mediana no Enem de toda UFRJ, o curso é mais seletivo, se a nota  mediana do curso no Enem era menor que a nota mediana no Enem da UFRJ, o curso é menos  seletivo   
  
- Seletividade (menos seletivo = 0 e mais seletivo=1)
  
Os dados originais estão armazenados em Excel e o modelo foi construído no software Stata

- Denominação e classificação das variáveis. 
- Codificação. 
- Tipo de questionários ou formulários. 
- Forma de armazenagem de dados. 
- Recursos computacionais disponíveis. 

# Situação do Projeto 

O projeto encontra-se na fase de testes dos modelos multiníveis. Após a entrevista com a pesquisadora algumas críticas à análise feita foram apontadas. Primeiramente, variáveis de nível 1 que podem ser estaticamente significantes foram excluídas do modelo testado. Anteriormente, um modelo de sobrevivência foi construído e seus resultados utilizados para determinar as variáveis a serem utilizadas nessa fase do estudo.Salientamos que essa não é uma tomada de decisão correta pois variáveis que não se mostraram significante na primeira etapa podem ser importantes na determinação do modelo multinível. São momentos e modelos diferentes, logo, todas as variáveis que a pesquisadora acredita que afeta a evasão do curso devem ser testadas.
Além disso, as variáveis contínuas nota do ENEM e CRa possuem magnetudes muito distintas. O CRa é uma noite que varia de 0 à 10 enquanto as notas do ENEM estão em uma escala de 0 à 1000. Essa diferença entre as escalas pode desencadear erros de convergência durante os testes no software.
Outro problema à análise realizada é a forma como as saídas do stata estão sendo apresentadas e analisadas

- Fase atual de implementação. 
- Descrição e críticas às análises já realizadas. 
- Recursos disponíveis. 
- Limitações de custo e tempo. 
- Problemas relacionados à coleta de dados. 

# Conclusão e respostas as perguntas da pesquisadora

## 1.1 Comentários sobre aspectos gerais do projeto
  

## 1.2 Sugestões sobre as variáveis

A primeira sugetão que oferecemos é incluir no modelo todas as variáveis com bom preenchimento (sem muitos MISSING) que a pesquisadora acredita que podem ter algum efeito na evasão do curso. Durante os testes dos modelos algumas vão mostrar-se significantes e outras não, porém, é importante testá-las. Além disso, também sugerimos o acrescimo de variáveis no nível 2. Por exemplo, o comportamento de evasão dos alunos parece ser diferente entre as áreas do conhecimento (Humanas, Exatas e Biológicas), logo, seria interessante construir essa variável categórica de curso.  
A seguir, incluímos uma lista de variáveis a ser incluídas no estudo:  
  
- Renda Familiar, Nível 1  
- Área do conhecimento do curso, Nível 2 (Humanas, Exatas e Biológicas)  
- Média da nota do ENEM do curso, Nível 2  
- Média do CRa do curso, Nível 2  
  
Por fim, destacamos a importância de padronizar as variáveis contínuas referentes à nota do ENEM, pois, como explicado anteriormente, as magnetudes distintas entre CRa e esse valor podem interferir na convergência matemática. A sugestão nesse relatório é tranformar os valores da variável de nota em números na escala de 0 à 10, a mesma utilizada no coeficiente de Rendimento acumulado por semestre

## 1.3 Como construir o modelo?

Sugerimos também testar interações entre as variáveis de nível 1, como por exemplo x e x

Passo 1: Ajuste do modelo sem variáveis independentes (modelo nulo) para calcular o coeficiente de correlação intraclasse e testar se as
variâncias em diferentes cursos são homogêneas
  
Passo 2: Incluir as variáveis independentes uma de cada vez e verificar a significância e o BIC de cada modelo; sendo o modelo escolhido nesse primeiro passo o que apresentar o coeficiente significativo e o menor BIC (pode ser o AKAIKE?)
  
Passo 3: Acrescentar novas variáveis até que nenhuma outra seja significativa,
chegando a um ou vários candidatos a modelo final
  
Passo 4: Fazer o diagnóstico dos candidatos a modelo final, verificando os
pressupostos e a qualidade do ajuste
  
  Fonte: https://bdm.unb.br/bitstream/10483/10032/1/2014_AlexLuizMartinsMatheusdaRocha.pdf
  
  
  Teste qui-quadrado de Wald: queremos testar a hipótese de que todos os coeficientes de regressão são zero.
  Se o teste indicar um p-valor < 0.001, então, temos evidências para negar essa hipótese. 
  
## 1.4 Como interpretar o modelo?

Na regressão logística de efeitos mistos, os coeficientes fixos têm uma interpretação condicional aos efeitos aleatórios. No caso do estudo analisado, as interpretações estão condicionadas aos cursos.

O ICC varia de 0 à 1 e indica o quanto da variação é explicada pela diferenças entre cursos. 
Um ICC = 0 indica que os cursos são homogêneos entre si, ou seja, a evasão independe do curso; 
Um ICC = 1 toda a variação pode ser explicada pela diferença entre os cursos;
Ou seja, se o ICC = 0.12 significa que 12% da chance de evasão na UFRJ é explicada pela diferença entre os cursos e 88% da chance de evasão é explicada pelas diferenças dentro dos cursos
É importante destacar que o ICC é encontrado quando rodamos um modelo "vazio", ou seja, apenas com o intercepto.
No software Stata, esse índice é encontrado através do código __estat icc__

Exemplo:  

Ng et al. (2006) analisam uma subamostra de dados da pesquisa de fertilidade de Bangladesh de 1989 (Huq e Cleland 1990), que entrevistou 1.934 mulheres de Bangladesh sobre o uso de anticoncepcionais. As mulheres na amostra pertenciam a 60 distritos, identificadas pela variável district. Cada distrito
continha áreas urbanas ou rurais (variável urban) ou ambas. A variável c_use é a resposta binária, com um valor de 1 indicando o uso de anticoncepcionais. Outras covariáveis incluem idade centrada na média e uma variável fatorial para o número de filhos. Considere um modelo de regressão logística:
  
$$ logit (\pi_{ij}) = \beta_0 + \beta_1*1.urban_{ij} + \beta_2*age_{ij} + \beta_3*1.children_{ij} + \beta_4*2.children_{ij} + \beta_5*3.children_{ij} + u_{ij}$$ 
  
para j = 1,. . . , 60 distritos, com i = 1,. . . , $n_{j}$ mulheres no distrito j

No software Stata a equação é dada por:  
__melogit c_use i.urban age i.children, nofvlabel|| district:__

A próxima seção é uma tabela das estimativas de efeitos fixos. As estimativas representam os coeficientes de regressão. Estes não são padronizados e estão na escala logit. As estimativas são seguidas por seus erros padrão (SEs), p-valor e intervalos de confiança.
O teste de razão de verossimilhança (LR) testa a hipótese nula de que os dois modelos, efeitos mistos e regressão logística fixa fornecem a mesma qualidade de ajuste. Como P < 0.001, há indicios para rejeitarmos a hipótese nula e utilizar, assim, o modelo misto.

```{r echo=FALSE}
knitr::include_graphics("modelo_aleatorio_v2.png")
```
A última seção nos dá as estimativas de efeito aleatório. Isso representa o desvio padrão estimado do intercepto na escala logit. 
Como ueremos a razão de chances em vez dos coeficientes na escala logit, podemos exponenciar as estimativas e os intervalos de confiança. Podemos fazer isso no Stata usando a opção OR. A tabela de estimativa relata os efeitos fixos e os componentes de variância estimados. Os efeitos fixos podem ser interpretados da mesma forma que a saída do logit tradicional.Transformando em razão de chances descobre-se que a chance das mulheres urbanas usarem anticoncepcionais é o dobra das mulheres em zona rural. Além disso, ter qualquer número de filhos aumentará as chances de três a quatro vezes em comparação com a categoria básica de não ter filhos. O uso de anticoncepcionais também diminui com a idade. 

Caso seja do interesse da pesquisadora introduzir um coeficiente aleatório em alguma variável dependente pode-se reescrever o modelo com "random slopes", ou seja, os coeficientes da variável escolhida irão variar entre cada cluster
Vampos aplicar essa ideia na variável binária urbana do exemplo anterior.O objetivo de introduzir um coeficiente aleatório na variável binária urbana é permitir efeitos aleatórios separados, dentro de cada distrito, para as áreas urbanas e rurais desse distrito.
A expressão desse modelo pode ser descrita da seguinte forma:  

$$ logit (\pi_{ij}) = \beta_0 + \beta_1*1.urban_{ij} + \beta_2*age_{ij} + \beta_3*1.children_{ij} + \beta_4*2.children_{ij} + \beta_5*3.children_{ij} + v_j*1.urban + u_{ij}$$ 

para j = 1,. . . , 60 distritos, com i = 1,. . . , $n_{j}$ mulheres no distrito j

No software Stata a equação é dada por:  
__melogit c_use i.urban age i.children || district: i.urban, covariance(unstructured)__

o modelo agora inclui um intercepto aleatório e um coeficiente aleatório em 1.urban. Além disso, ao especificar a covariância (não estruturada) acima, dissemos ao melogit para permitir a correlação entre efeitos aleatórios a nível distrital, ou seja, a correlação entre $u_j$ e $v_j$ é diferente de zero
  
```{r echo=FALSE}
knitr::include_graphics("modelo_slope_aleatorio_v1.png")
```


## 1.5 Exemplo de análise a partir da saída do software Stata

Probabilidades são uma boa escala para compreender intuitivamente os resultados; no entanto, elas não são lineares. Isso significa que um aumento de uma unidade em uma variável não é igual a um aumento constante na probabilidade - a mudança na probabilidade depende dos valores escolhidos para as outras variáveis pois, em modelos logísticos multivariados, os efeitos aleatórios também influenciam os resultados.Assim, se você mantiver tudo constante, a mudança na probabilidade do resultado sobre diferentes valores de sua variável de interesse só é verdadeira quando todas as variáveis são mantidas constantes e você está no mesmo grupo ou em um grupo com o mesmo efeito aleatório.
Uma alternativa atraente é obter a probabilidade marginal média.

## 1.6 Sugestões de como avaliar a qualidade do ajuste do modelo logistíco multinivel

QQplot resíduos

Quando construímos um modelo é sempre necessário checar a eficácia do mesmo. Além disso, precisa-se utilizar uma métrica para comparar diferentes modelos e encontrar qual o melhor para o conjunto de dados. Assim, esse tópico foca em apresentar medidas de desempenho para o ajuste da regressão logística multinível

Podemos avaliar o ajuste do modelo realizando uma análise residual através de um gráfico (Pearson, deviance, Anscombe)



Máxima Verossimilhança

Por meio da deviance é possível medir o grau de desajuste do modelo. A deviance é definida por:
 $$Deviance = – 2 ln(L0) – [– 2 ln(L1)]  $$
 
em que L0 é a verossimilhança do modelo nulo, ou seja, sem a presença de
covariáveis, L1 é a verossimilhança do modelo completo
Assim, tem-se que o modelo que apresentar a menor deviance é aquele que melhor se ajusta ao conjunto de dados (https://bdm.unb.br/bitstream/10483/8038/1/2013_AmandaPereiraFerraz.pdf)


## 1.4 Bibliografia

- Comentários sobre aspectos gerais do projeto: viabilidade, abrangência das 
conclusões, etc. 
- Considerações sobre a condução do projeto: desvios em relação ao objetivo.
- Sugestões para análise estatística: modelos, técnicas apropriadas, etc.
- Bibliografia apropriada para o pesquisador. 
- Possibilidade de execução através do CEA ou outras alternativas.
